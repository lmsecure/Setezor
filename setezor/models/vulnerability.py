from datetime import datetime
from typing import Optional, List
from setezor.models import IDDependent, Base
from sqlmodel import Field, Relationship

class Vulnerability(IDDependent, Base, table=True):
    __tablename__ = "software_vulnerability"
    __table_args__ = {
        "comment": "Таблица предназначена для хранения уязвимостей"
    }
    
    name: str                      = Field(sa_column_kwargs={"comment":"Наименование уязвимости"})
    cve: Optional[str]             = Field(sa_column_kwargs={"comment":"CVE уязвимости"})
    cwe: Optional[str]             = Field(sa_column_kwargs={"comment":"CWE уязвимости"})
    description: Optional[str]     = Field(sa_column_kwargs={"comment":"Описание уязвимости"})
    details: Optional[str]         = Field(sa_column_kwargs={"comment":"Детали уязвимости"})
    cvss: Optional[str]            = Field(sa_column_kwargs={"comment":"CVSS уязвимости"})
    cvss2: Optional[str]           = Field(sa_column_kwargs={"comment":"CVSS2 уязвимости"})
    cvss2_score: Optional[float]   = Field(sa_column_kwargs={"comment":"CVSS2 рейтинг уязвимости"})
    cvss3: Optional[str]           = Field(sa_column_kwargs={"comment":"CVSS3 уязвимости"})
    cvss3_score: Optional[float]   = Field(sa_column_kwargs={"comment":"CVSS3 рейтинг уязвимости"})
    cvss4: Optional[str]           = Field(sa_column_kwargs={"comment":"CVSS4 уязвимости"})
    cvss4_score: Optional[float]   = Field(sa_column_kwargs={"comment":"CVSS4 рейтинг уязвимости"})
    severity: Optional[int]        = Field(sa_column_kwargs={"comment":"Тяжесть последствий"})
    request: Optional[str]         = Field(sa_column_kwargs={"comment":"Запрос"})
    response: Optional[str]        = Field(sa_column_kwargs={"comment":"Ответ"})
    impact: Optional[str]          = Field(sa_column_kwargs={"comment":"Влияние"})
    affects_detail: Optional[str]          = Field(sa_column_kwargs={"comment":"Параметр"})
    affects_url: Optional[str]          = Field(sa_column_kwargs={"comment":"Адрес"})
    created_at_in_acunetix: Optional[datetime] = Field(sa_column_kwargs={"comment":"Дата-время удаления сущности"},)

    recommendation: Optional[str]  = Field(sa_column_kwargs={"comment": "Рекомендации по устранению уязвимости"})

    l4_softwares: List["L4SoftwareVulnerability"] = Relationship(back_populates="vulnerability") # type: ignore
    links: List["VulnerabilityLink"] = Relationship(back_populates="vulnerability") # type: ignore