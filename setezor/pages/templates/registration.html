<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/static/assets/favicon.ico" rel="icon">
    <link href="/static/css/vendor/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/vendor/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/css/src/particles.css" rel="stylesheet">
    <link href="/static/css/src/reg_and_auth.css" rel="stylesheet">
    <script src="/static/js/libs/bootstrap.bundle.min.js"></script>
    <script src="/static/js/libs/particles.min.js"></script>
    <script src="/static/js/libs/i18next.min.js"></script>
    <script src="/static/js/src/translate_i18n.js"></script>
    <script src="/static/js/src/toasts.js"></script>
    <title>Setezor: Registration</title>
   
</head>

<body>
    <div id="particles-js"></div>
    <div class="position-fixed top-0 end-0 pe-1" id="toastHolderParent" style="margin-top: 5px;">
      <div id="toast_holder"></div>
    </div>
    <form onsubmit="registration(event)" name="registrationFormName">
        <div class="wrapper">
            <form action="#">
                <h2 style="margin-bottom: 2rem;" data-i18n="Registration"></h2>
                <div class="input-field">
                    <input type="text" name="login" maxlength="25" required>
                    <label data-i18n="Login"></label>
                </div>
                <div class="input-field">
                    <input type="password" name="password" minlength="10" required>
                    <label data-i18n="Password"></label>
                </div>
                <div class="input-field">
                    <input type="password" name="password_confirmation" minlength="10" required>
                    <label data-i18n="Password Confirm"></label>
                </div>
                {% if not open_reg %}
                <div class="input-field">
                    <input type="password" name="invite_token" required>
                    <label data-i18n="Invite token"></label>
                </div>
                {% endif %}
                <button type="submit" data-i18n-value="Login" data-i18n="Register"></button>
                <div class="login" style="margin-top: 1rem;">
                  <p>
                    <span data-i18n="Have an account?"></span>
                    <a href="/login" style="color: rgb(2, 144, 214); display: block; padding: 4px;" data-i18n="LoginAutorize"></a>
                  </p>
                </div>
                <div class="dropdown" style="margin-top: -2rem;">
                  <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="languageDropdown" style="--bs-btn-color: rgb(17,17,17); --bs-btn-border-color: rgb(17,17,17);"
                      data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-translate"></i>
                    <span id="currentLanguage">EN</span>
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="languageDropdown">
                    <li><a class="dropdown-item language-option" href="#" data-value="en">English</a></li>
                    <li><a class="dropdown-item language-option" href="#" data-value="ru">Русский</a></li>
                  </ul>
                </div>
            </form>
        </div>
    </form>

    <script>
    function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

    document.addEventListener('DOMContentLoaded', function() {
        const token = getQueryParam('token');
        if (token) {
            const tokenField = document.querySelector('input[name="invite_token"]');
            if (tokenField) {
                tokenField.value = token;
            }
        }
    });
        async function registration(event) {
            event.preventDefault();
            let formData = new FormData(event.target)
            if (formData.get('password') != formData.get('password_confirmation')){
              create_toast("Error", "Password and password confirmation mismatch", 'error')
              return;
            }
            resp = await fetch("/api/v1/auth/register", {
              method: "POST",
              headers: { "Content-type": "application/json" },
              body: JSON.stringify(Object.fromEntries(formData))})
            let answer = await resp.json()
            if (resp.status != 200){
              create_toast("Error", answer.detail, 'error')
              return
            }
            window.location.href = "/login"
        }
    </script>
    <script defer src="/static/js/src/particles.js"></script>
    <script defer src="static/js/src/update_language.js"></script>
</body>

</html>